# AI助手历史问题功能说明

## 🎯 功能概述

AI助手页面现已支持历史问题功能，用户可以：
- 查看之前咨询过的问题和答案
- 重新提问历史问题
- 删除不需要的历史记录
- 清空所有历史记录

## ✨ 主要特性

### 1. 历史问题侧边栏
- 实时显示历史问题列表
- 显示问题内容和时间
- 支持点击查看完整对话

### 2. 智能时间显示
- 刚刚（1分钟内）
- X分钟前（1小时内）
- X小时前（1天内）
- 完整日期时间（超过1天）

### 3. 历史记录管理
- **重新提问**：快速重新发送历史问题
- **删除记录**：删除单个历史记录
- **清空历史**：一键清空所有历史记录

### 4. 数据持久化
- 自动保存到数据库
- 本地存储备份
- 跨会话数据同步

## 🚀 使用方法

### 访问AI助手页面
```
http://localhost:3001/ai-assistant
```

### 功能操作

1. **查看历史问题**
   - 右侧历史问题侧边栏显示所有历史记录
   - 点击任意历史记录可查看完整对话

2. **重新提问**
   - 点击历史记录中的"重新提问"按钮
   - 系统会自动填入问题并发送

3. **删除记录**
   - 点击历史记录中的"删除"按钮
   - 确认后删除该条记录

4. **清空历史**
   - 点击侧边栏底部的"清空历史"按钮
   - 确认后清空所有历史记录

## 🛠️ 技术实现

### 前端功能
- **响应式设计**：适配不同屏幕尺寸
- **实时更新**：历史记录实时同步
- **本地备份**：使用localStorage作为备份存储
- **用户体验**：加载动画、确认对话框等

### 后端API
- `POST /api/ai/history` - 保存历史记录
- `GET /api/ai/history` - 获取历史记录
- `DELETE /api/ai/history/:id` - 删除单个记录
- `DELETE /api/ai/history` - 清空所有记录

### 数据库设计
```sql
CREATE TABLE ai_chat_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    timestamp VARCHAR(50),
    session_id VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_session_id (session_id),
    INDEX idx_created_at (created_at)
);
```

## 📊 数据统计

- 最多显示50条历史记录
- 按时间倒序排列
- 支持会话分组
- 自动清理过期数据

## 🔧 配置选项

### 环境变量
```env
# 历史记录保留天数（可选）
HISTORY_RETENTION_DAYS=30
```

### 自定义设置
- 修改历史记录显示数量
- 调整时间显示格式
- 自定义历史记录样式

## 🎨 界面预览

```
┌─────────────────────────────────────────────────────────┐
│                    AI智能助手                            │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌─────────────────────────────┐ │
│  │   智能对话区域        │  │      历史问题侧边栏         │ │
│  │                     │  │  ┌─────────────────────────┐ │ │
│  │  [用户问题]          │  │  │  📋 历史问题            │ │ │
│  │  [AI回答]            │  │  │  ┌─────────────────────┐ │ │ │
│  │                     │  │  │  │ 如何选择PLC？        │ │ │ │
│  │  [输入框]            │  │  │  │ 2分钟前             │ │ │ │
│  │  [发送按钮]          │  │  │  │ [重新提问] [删除]    │ │ │ │
│  │                     │  │  │  └─────────────────────┘ │ │ │
│  └─────────────────────┘  │  │  ┌─────────────────────┐ │ │ │
│                           │  │  │ 变频器故障诊断       │ │ │ │
│                           │  │  │ 5分钟前             │ │ │ │
│                           │  │  │ [重新提问] [删除]    │ │ │ │
│                           │  │  └─────────────────────┘ │ │ │
│                           │  │  [清空历史]              │ │ │
│                           │  └─────────────────────────┘ │ │
│                           └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

## 🔄 更新日志

### v1.0.0 (2024-08-15)
- ✅ 新增历史问题功能
- ✅ 实现历史记录保存和检索
- ✅ 添加历史记录管理功能
- ✅ 优化用户界面和交互体验
- ✅ 实现数据持久化存储

## 📝 注意事项

1. **数据安全**：历史记录仅存储在本地数据库，不会上传到第三方服务
2. **隐私保护**：用户可以随时删除历史记录
3. **性能优化**：历史记录按需加载，避免影响页面性能
4. **兼容性**：支持现代浏览器，建议使用Chrome、Firefox、Safari等

## 🆘 常见问题

**Q: 历史记录会保存多久？**
A: 历史记录会永久保存，除非用户手动删除或清空。

**Q: 可以导出历史记录吗？**
A: 目前不支持导出功能，后续版本会考虑添加。

**Q: 历史记录会占用多少存储空间？**
A: 每条记录约占用1-2KB空间，50条记录约占用50-100KB。

**Q: 如何备份历史记录？**
A: 历史记录会自动备份到浏览器本地存储，重新打开页面时会自动恢复。

---

*如有问题或建议，请联系开发团队。*


